<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.19.0/phaser.js"></script>

    <style type="text/css">
        body {  
            left: 2000;
            }
    </style>
</head>
<body>

<script type="text/javascript">

let startingVelocity = 250;
let ball1, ball2, player, ball, mouseDown, mouseDownX, mouseDownY, sprite, bmd, graphics, platforms, rect1;
let borders = []
function preload() {
  this.load.image("ball", "assets/cannonBall.png");
  this.load.image("bomb", "assets/hbomb.png");
  this.load.image('platform', 'assets/platform.png');
}

function create() {
    
    player = this.add.circle(200, 200, 20, 0x0066ff);
    this.physics.add.existing(player);
    player.body.setCircle(20, 0, 0);
    player.body.useDamping = true;//.setDamping(true).setDrag(0.98);
    player.body.setDrag(.98);
    player.body.setBounce(1);    
    ball = this.add.circle(200+Math.random()*100, 200+Math.random()*100, 20, 0xdd66ff);
    this.physics.add.existing(ball);
    ball.body.setCircle(20, 0, 0);
    ball.body.useDamping = true;
    ball.body.setDrag(.98);
    ball.body.setBounce(1);


    borders[0] = this.add.rectangle(400, 150, 600, 20, 0x6666ff);
    borders[1] = this.add.rectangle(400, 450, 600, 20, 0x6666ff);
    borders[2] = this.add.rectangle(100, 300, 20, 300, 0x6666ff);
    borders[3] = this.add.rectangle(700, 300, 20, 300, 0x6666ff);
    for (element of borders) {
      this.physics.add.existing(element);
      element.body.setImmovable(true);    
    }

    myLine = this.add.graphics();
    myLine.lineStyle(2, 0x00ff00, 1);

    this.input.on("pointerup", function(pointer) {
        player.body.setVelocity((player.x-pointer.x)*10, (player.y-pointer.y)*10);
        mouseDown = false;
        myLine.clear();
    });

    this.input.on('pointerdown', function(pointer){
     
          mouseDown = true;
          mouseDownX = pointer.x;
          mouseDownY = pointer.y;
    }, this);

    this.input.on('pointermove', function(pointer, localX, localY, event){ 
        if(mouseDown === true){
            myLine.clear();
            myLine.lineBetween(player.x, player.y, player.x+(player.x-pointer.x), player.y+(player.y-pointer.y));
            // myLine.beginPath();
            // myLine.moveTo(100, 100);
            // myLine.lineTo(200, 200);
            // myLine.closePath();
            // myLine.strokePath();
        } 
    }, this);

    this.physics.add.collider(player, borders);
    this.physics.add.collider(player, ball, playerBallCollision);
    this.physics.add.collider(ball, borders);
}

function playerBallCollision() {
  player.body.setVelocity(0,0);
}

function worldCollision() {}

function update() {
  // this.physics.world.collide(ball1, [border]);
}

var config = {
  type: Phaser.AUTO,
  width: 1000,
  height: 800,
  physics: {
    default: "arcade",
    arcade: {
      debug: true,
      gravity: { y: 0, x: 0 }
    }
  },
  scene: {
    preload: preload,
    create: create
  }
};

var game = new Phaser.Game(config);

</script>

</body>
</html>
